{% extends 'base.html.twig' %}

{% block body %}
  <input value="Click" id="start" type="submit" />
{% endblock %}
{% block javascripts %}
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.11.1.js"></script>
    <script>

        $(document).ready(function() {

            var url = window.location.href;

            if(url.indexOf("#access_token=") !== -1) {
                url = url.replace(/#/gi, "?");
                console.log(url);
                window.open(url, '_self');
            }

            $("#start").click(function() {
               doLogin(function() {});
            });
        });

       // var g_tracks = '';
       // var g_name = '';
        var client_id = "{{ client_id }}";
        var redirect_uri = "{{ app.request.uri }}";

        var doLogin = function(callback) {

            var url = 'https://accounts.spotify.com/api/authorize?client_id=' + client_id +
                    '&response_type=token' +
                    '&scope=playlist-read-private%20playlist-modify' +
                    '&show_dialog=true&redirect_uri=' + encodeURIComponent(redirect_uri);
          //  localStorage.setItem('createplaylist-tracks', JSON.stringify(g_tracks));
         //   localStorage.setItem('createplaylist-name', g_name);
            var w = window.open(url, '_self');
        }
    </script>
{% endblock %}